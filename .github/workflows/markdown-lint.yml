# =============================================================================
# ðŸ“ MARKDOWNLINT CI/CD WORKFLOW
# =============================================================================
# Proyecto: PRO_FINAN_CONTA_PYM - FinTech SaaS MÃ©xico
# PropÃ³sito: Validar calidad de documentaciÃ³n Markdown en cada PR/push
# DocumentaciÃ³n: https://github.com/DavidAnson/markdownlint-cli2-action
# =============================================================================

name: ðŸ“ Lint Markdown

on:
  # Ejecutar en push a main
  push:
    branches: [main, develop]
    paths:
      - '**/*.md'
      - '.markdownlint.jsonc'
      - '.markdownlint-cli2.jsonc'
  
  # Ejecutar en Pull Requests
  pull_request:
    branches: [main, develop]
    paths:
      - '**/*.md'
      - '.markdownlint.jsonc'
      - '.markdownlint-cli2.jsonc'
  
  # Permitir ejecuciÃ³n manual
  workflow_dispatch:

jobs:
  markdownlint:
    name: ðŸ” Lint Markdown Files
    runs-on: ubuntu-latest
    
    steps:
      # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      # 1. Checkout del repositorio
      # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      - name: ðŸ“¥ Checkout repository
        uses: actions/checkout@v4
        with:
          fetch-depth: 0  # Full history para mejor anÃ¡lisis

      # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      # 2. Ejecutar markdownlint-cli2
      # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      - name: ðŸ“ Run markdownlint
        uses: DavidAnson/markdownlint-cli2-action@v19
        with:
          # Usar configuraciÃ³n del proyecto
          config: '.markdownlint-cli2.jsonc'
          
          # Archivos a lint (respeta ignores del config)
          globs: |
            **/*.md
            !node_modules/**
            !00_LEGADO_PRIMERA_LLUVIA_IDEAS/**
            !.git/**

      # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      # 3. Resumen del resultado
      # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      - name: âœ… Lint Summary
        if: success()
        run: |
          echo "## âœ… Markdown Linting Passed!" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "All Markdown files comply with project standards." >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "**Configuration:** \`.markdownlint.jsonc\`" >> $GITHUB_STEP_SUMMARY

      - name: âŒ Lint Failed Summary
        if: failure()
        run: |
          echo "## âŒ Markdown Linting Failed" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "Some Markdown files have issues. Please fix them before merging." >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "### ðŸ”§ How to fix locally:" >> $GITHUB_STEP_SUMMARY
          echo "1. Open VS Code in the project" >> $GITHUB_STEP_SUMMARY
          echo "2. Press \`Ctrl+Shift+P\` â†’ \`markdownlint: Lint Workspace\`" >> $GITHUB_STEP_SUMMARY
          echo "3. Fix issues shown in the Problems panel" >> $GITHUB_STEP_SUMMARY
          echo "4. Or use auto-fix: \`Ctrl+Shift+P\` â†’ \`Format Document\`" >> $GITHUB_STEP_SUMMARY
